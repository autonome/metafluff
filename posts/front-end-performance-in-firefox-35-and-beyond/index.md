---
layout: post
title: "Front-end Performance in Firefox 3.5 and Beyond"
published_at: 2009-05-06
date: 2009-05-06
tags: Awesomebar Bookmarks firefox firefox mozilla mozilla Performance Places
---

One of the major changes in Firefox 3 was the amount of browsing history saved. In Firefox 2, the default amount of history saved was 9 days, so just over a week. The default in Firefox 3 is 180 days. Or 6 months. Or *20 times* the amount that Firefox 2 stored. However you slice it, it's a far greater amount of data than was previously stored. An example benefit is that we can use this set of data to more accurately predict what you're searching for in the Awesomebar. However, the challenge is to keep the browser *fast*, at least as fast as if we still only stored 9 days, and not only in the Awesomebar, but everywhere and anywhere that this data is exposed.

[Firefox 3.5](https://wiki.mozilla.org/Firefox3.5) contains a large number of internal changes to how we store, manage and display this data, in order to improve performance. [Shawn Wilsher](http://twitter.com/sdwilsh "Shawn on Twitter") and [Marco Bonardo](http://twitter.com/mak77 "Marco on Twitter") spent an immense amount of time and effort altering almost every SQL query in [Places](https://wiki.mozilla.org/Places), the bookmark and history infrastructure, so that it no longer needs to write to the database every time you visit a page, a project [well](http://shawnwilsher.com/archives/168) [chronicled](http://shawnwilsher.com/archives/169) [on](http://shawnwilsher.com/archives/170) [Shawn's](http://shawnwilsher.com/archives/172) [blog](http://shawnwilsher.com/archives/242). Spurred on by one of [Shawn's performance wins](https://bugzilla.mozilla.org/show_bug.cgi?id=478097), [Ed Lee](http://ed.agadak.net/ "Ed") was able to drastically [speed up searching in the Awesomebar](http://ed.agadak.net/2009/02/looking-for-location-bar-perf-testers). Even now, we're working on changes that will vastly improve the performance of the [history menu](https://bugzilla.mozilla.org/show_bug.cgi?id=488966), sidebar, and smart folders, as well as just [browsing around the Library](https://bugzilla.mozilla.org/show_bug.cgi?id=490664). To try out some of these changes, [download the latest beta of Firefox 3.5](http://www.mozilla.com/en-US/firefox/all-beta.html "Firefox 3.5 Beta 4").

This work has been aided by better visibility and diagnosis of performance regressions due to tools such as [Shark](http://developer.apple.com/tools/sharkoptimize.html) and [DTrace](https://wiki.mozilla.org/Performance/Optimizing_JavaScript_with_DTrace), and all the work [Alice](http://alice.nodelman.net/blog/) and others have done in performance monitoring on Tinderbox. Also, Shawn's work on [mozStorage](https://developer.mozilla.org/en/Storage), the SQLite interface in Firefox, has provided us with reporting of [poorly performing queries](http://shawnwilsher.com/archives/251) in debug builds.

A recent effort to gather real world usage data is the [Places Statistics project](https://places-stats.mozilla.com/), run by [Drew Willcoxon](http://blog.mozilla.com/adw/) and [David Dahl](http://daviddahl.blogspot.com/). Drew created a script that culled statistical information about browsing behavior from the database that stores a user's history and bookmarks. Users who wish to participate can anonymously submit their statistics to a website that aggregates the data. David wrote a Python tool that generates databases based on the aggregate data, that we can use as canonical datasets to test against. One of the first ways we'll put this data to use is to run our current [performance test suite](https://wiki.mozilla.org/Performance:Tinderbox_Tests) against minimum, average and maximum sized databases generated by this tool.

Firefox will never be fast enough, so the work continues into [Firefox.next](https://wiki.mozilla.org/Firefox/Namoroka). We're using [asynchronous SQL queries](https://developer.mozilla.org/en/Storage#Asynchronously) to move more database activity into the background, so as to not block the browser UI. This will surface in the Awesomebar (testable via [Shawn's extension](http://shawnwilsher.com/archives/255)) and [Drew Willcoxon's](http://blog.mozilla.com/adw/) work on the [Places query system](https://bugzilla.mozilla.org/show_bug.cgi?id=490714).

You can help: If you think something is too slow, please [file a bug](https://bugzilla.mozilla.org/enter_bug.cgi), and add "[TSnappiness]" to bug's whiteboard field, or in your report. Here's the current [list of TSnappiness bugs](https://bugzilla.mozilla.org/buglist.cgi?quicksearch=tsnappiness).

[UPDATE: Thanks jst for pointing out my humble interpretation of 180 days as only 3 months]